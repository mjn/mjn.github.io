<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} | Mark Northcott</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <script>
    // Check for saved theme preference, otherwise use system preference
    const getTheme = () => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      return 'terminal'; // Default
    };

    const applyTheme = (theme) => {
      const html = document.documentElement;
      const themes = ['light-mode', 'everforest-mode', 'catppuccin-mode', 'gruvbox-mode'];
      themes.forEach(t => html.classList.remove(t));
      
      if (theme !== 'terminal') {
        html.classList.add(`${theme}-mode`);
      }
      localStorage.setItem('theme', theme);
    };

    applyTheme(getTheme());
  </script>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 sm:p-8 transition-colors duration-300" data-input-path="{{ page.inputPath }}">
  <div class="w-full max-w-5xl mx-auto border-2 border-terminal-accent rounded-lg p-6 sm:p-10 relative">
    <div class="absolute -top-3 left-6 px-2 bg-terminal-bg text-terminal-accent font-mono font-bold">mark@northcott.io</div>
    <header class="mb-8 font-mono flex justify-between items-center">
      <nav>
        <span class="text-terminal-prompt">mark@northcott.io:~$</span>
        <a href="/" class="text-terminal-accent hover:underline ml-2">home</a>
        <a href="/blog/" class="text-terminal-accent hover:underline ml-4">blog</a>
        <a href="/experience/" class="text-terminal-accent hover:underline ml-4">experience</a>
      </nav>
      <div class="relative flex items-center font-mono text-terminal-text">
        <button id="theme-trigger" class="hover:tui-inverse focus:tui-inverse outline-none px-1 transition-colors duration-200">
          [theme: <span id="current-theme-name">tokyo-night</span>]
        </button>
        <div id="theme-menu" class="hidden tui-dropdown-menu mt-1">
          <div class="tui-dropdown-item" data-value="terminal">tokyo-night</div>
          <div class="tui-dropdown-item" data-value="light">light</div>
          <div class="tui-dropdown-item" data-value="everforest">everforest</div>
          <div class="tui-dropdown-item" data-value="catppuccin">catppuccin</div>
          <div class="tui-dropdown-item" data-value="gruvbox">gruvbox</div>
        </div>
      </div>
    </header>
    <main>
      {{ content | safe }}
    </main>
    <footer class="mt-16 text-sm text-terminal-text opacity-50 font-mono">
      &copy; 2025 Mark Northcott
    </footer>
  </div>

  <script>
    const themeTrigger = document.getElementById('theme-trigger');
    const themeMenu = document.getElementById('theme-menu');
    const themeNameDisplay = document.getElementById('current-theme-name');
    const themeItems = document.querySelectorAll('.tui-dropdown-item');

    const themeNames = {
      'terminal': 'tokyo-night',
      'light': 'light',
      'everforest': 'everforest',
      'catppuccin': 'catppuccin',
      'gruvbox': 'gruvbox'
    };

    // Initialize display name
    const currentTheme = getTheme();
    themeNameDisplay.textContent = themeNames[currentTheme] || currentTheme;

    // Toggle menu
    themeTrigger.addEventListener('click', (e) => {
      e.stopPropagation();
      themeMenu.classList.toggle('hidden');
    });

    // Handle selection
    themeItems.forEach(item => {
      item.addEventListener('click', () => {
        const theme = item.getAttribute('data-value');
        applyTheme(theme);
        themeNameDisplay.textContent = themeNames[theme];
        themeMenu.classList.add('hidden');
      });
    });

    // Close on click outside
    document.addEventListener('click', (e) => {
      if (!themeMenu.contains(e.target) && !themeTrigger.contains(e.target)) {
        themeMenu.classList.add('hidden');
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        themeMenu.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
